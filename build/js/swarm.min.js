Swarm={},Swarm.ActivityFeed=function(){},Swarm.ActivityFeed.prototype={init:function(){var e=this;Swarm.api.initCurrentView(),Swarm.api.pushCurrentView("activityfeed"),swarmInstance.getCurrentUserMugshot(),e.displayActivityFeed()},displayActivityFeed:function(){var e=this;$("#content");$("#content").empty(),Swarm.utils.showLoadingIcon(),jQuery.ajax({type:"GET",url:"https://www.yammer.com/api/v1/streams/activities.json?access_token="+yammer.getAccessToken(),data:{limit:20},dataType:"json",xhrFields:{withCredentials:!1},success:function(t){Swarm.utils.hideLoadingIcon(),e.buildActivityFeed(t)},error:function(){Swarm.utils.hideLoadingIcon(),alert("error")}})},buildActivityFeed:function(e){var t=$("#content"),a=e.items,n=e.references;e.objects;0==t.find("div.feed_main").length&&t.append('<div class="feed_main"></div>'),$.each(a,function(e,t){var a,i,r,s,o,c,l,m=t.message,u=[];$.each(m.split(" "),function(e,t){if(i=t.indexOf("]"),-1!=(a=t.indexOf("user:"))){r=t.substring(a+5,i);var m=$.grep(n,function(e){return e.id==r});s=m.length>0?m[0].full_name:"",o=m.length>0?m[0].mugshot_url:"",l=s}else if(-1!=(a=t.indexOf("group:"))){c=t.substring(a+6,i);var m=$.grep(n,function(e){return e.id==c});s=m.length>0?m[0].full_name:""}else if(-1!=(a=t.indexOf("page:"))){pageId=t.substring(a+5,i);var d=$.grep(n,function(e){return e.id==pageId});s=d.length>0?d[0].full_name:""}else if(-1!=(a=t.indexOf("uploaded_file:"))){pageId=t.substring(a+14,i);var d=$.grep(n,function(e){return e.id==pageId});s=d.length>0?d[0].full_name:""}else s=t;u.push(s)}),m=u.join(" "),t.userId=r,t.userName=l,t.createdDate=Swarm.utils.getCreatedDate(t.created_at),t.itemUrl=o,t.msg_body=m}),t.find("div.feed_main").append(Swarm.templates.notifications({items:e.items})),t.slimScroll().off("slimscroll"),t.slimScroll().removeData("events"),t.off("click",".feed_main a.senderLinkAnc").on("click",".feed_main a.senderLinkAnc",function(){var e=$(this),t=e.data("user-id"),a=new Swarm.Profile;$(window).off("scroll"),a.init(t)})}},Swarm.Analytics=function(){},Swarm.Analytics.prototype={init:function(){var e=this;$(window).off("scroll"),Swarm.utils.showLoadingIcon(),Swarm.api.initCurrentView(),Swarm.api.pushCurrentView("analytics"),swarmInstance.getCurrentUserMugshot(),jQuery.ajax({type:"GET",url:"https://www.yammer.com/api/v1/users/current.json?access_token="+yammer.getAccessToken()+"&include_group_memberships=true",dataType:"json",xhrFields:{withCredentials:!1},success:function(t){$("#content").html('<div id="donut_chart" class="msg_main" style="width:340px;height:250px;padding-top:10px"></div>');var a=e.generateGroupData(t);e.drawChart(a),Swarm.utils.hideLoadingIcon(),$("div.uv-chart-div").off("click"),$("div.uv-chart-div").on("click","g.uv-arc-groups",function(t){e.getGroupMessages(a[$(this).index()].id)})},error:function(){Swarm.utils.hideLoadingIcon(),alert("error")}})},getGroupMessages:function(e){jQuery.ajax({type:"GET",url:"https://www.yammer.com/api/v1/messages/in_group/"+e+".json?access_token="+yammer.getAccessToken(),data:{limit:7},dataType:"json",xhrFields:{withCredentials:!1},success:function(e){$("#content").find("div.feed_main").remove(),Swarm.utils.buildFeedInfo(!1,e)},error:function(){alert("error")}})},generateGroupData:function(e){var t=[];return $.each(e.group_memberships,function(e,a){10>e&&t.push({name:a.full_name,value:21-2*e,id:a.id})}),t},generateGroupChart:function(e,t){var a=this,n=0,i={},r=function(s){i[e.group_memberships[n].id]=s,n++,n<e.group_memberships.length?a.constructGroupData(e,n,r):t(i)};a.constructGroupData(e,n,r)},constructGroupData:function(e,t,a){var n=e.group_memberships[t].id;e.group_memberships[t].full_name;jQuery.ajax({type:"GET",url:"https://www.yammer.com/api/v1/messages/in_group/"+n+".json?access_token="+yammer.getAccessToken(),dataType:"json",xhrFields:{withCredentials:!1},success:function(e){a(e)},error:function(){alert("error")}})},drawChart:function(e){var t={graph:{bgcolor:"none",custompalette:["#A6CEE3","#1F78B4","#B2DF8A","#33A02C","#FB9A99","#E31A1C","#FDBF6F","#FF7F00","#CAB2D6","#6A3D9A"]},dimension:{width:200,height:200},meta:{caption:"Top 10 groups in the past week"},label:{suffix:"",strokecolor:"#555"},margin:{top:20,bottom:20,left:-1,right:100},caption:{fontvariant:"none"},frame:{bgcolor:"none"},axis:{fontfamily:"Arial"},legend:{position:"right",fontfamily:"Arial"},caption:{fontfamily:"Arial"},subCaption:{fontfamily:"Arial"}},a={categories:["groups"],dataset:{groups:e}};t.meta.position="#donut_chart",uv.chart("Pie",a,t)}},Swarm.API=function(e){var t=this;t.networks={},t.primaryAccessToken=e,t.accessToken=e,t.currentUserId="",t.currentViewStack=[],t.init()},Swarm.API.prototype={init:function(){var e=this;e.getUserNetworkAccessTokens()},ajaxCall:function(e,t,a,n){var i=this;jQuery.ajax({type:e,url:t,beforeSend:function(e){e.setRequestHeader("Authorization","Bearer "+i.getAccessToken())},data:$.extend({},{},a),dataType:"json",xhrFields:{withCredentials:!1},success:function(e){void 0!==n&&n(e)},error:function(e){console.log(e),alert("Unable to fetch data from Yammer network")}})},setAccessToken:function(e){this.accessToken=e},getAccessToken:function(){return this.accessToken},setCurrentUserId:function(e){this.currentUserId=e},getCurrentUserId:function(){return this.currentUserId},setNetworks:function(e){var t=this;e.forEach(function(e,a){t.networks[a.network_id]=a})},setPrimaryNetwork:function(e){var t=this;t.activeNetwork=t.networks[e]},switchNetwork:function(e){var t=this;t.activeNetwork=t.networks[networkId],t.setAccessToken(t.activeNetwork.token)},getCurrentView:function(){var e=this;return e.currentViewStack[e.currentViewStack.length-1]},pushCurrentView:function(e){var t=this;-1==t.currentViewStack.indexOf(e)&&t.currentViewStack.push(e)},popCurrentView:function(){var e=this;e.currentViewStack.pop()},initCurrentView:function(){var e=this;e.currentViewStack.splice(0,e.currentViewStack.length)},displayBackButton:function(){var e=$(".header .current-mugshot");$("#content");e.html('<i class="material-icons" style="font-size:1.5em;cursor:pointer;padding:6px 3px;">arrow_back</i>')},getCurrentUserProfile:function(e){var t=this;t.ajaxCall("GET","https://www.yammer.com/api/v1/users/current.json",{},e)},getUserNetworks:function(e){var t=this;t.ajaxCall("GET","https://www.yammer.com/api/v1/networks/current.json",{},e)},getUserNetworkAccessTokens:function(e){var t=this,a=t.accessToken;t.setAccessToken(t.primaryAccessToken),t.ajaxCall("GET","https://www.yammer.com/api/v1/oauth/tokens.json",{},function(e){t.setNetworks(e),t.setAccessToken(a)})},getThreadedMessagesFeed:function(e,t,a){var n=this,i=$.extend({threaded:"extended",limit:20},a),r="https://www.yammer.com/api/v1/messages.json/my_feed.json";"all"===e?r="https://www.yammer.com/api/v1/messages.json":"top"===e?r="https://www.yammer.com/api/v1/messages/algo.json":"following"===e?r="https://www.yammer.com/api/v1/messages/following.json":console.log("Unknown message channel: "+e),n.ajaxCall("GET",r,i,t)},getThread:function(e,t,a){var n=this,i=$.extend({limit:20},a),r="https://www.yammer.com/api/v1/messages/in_thread/"+e+".json";n.ajaxCall("GET",r,i,t)},getGroupThreads:function(e,t,a){var n=this,i=$.extend({threaded:"extended",limit:20},a),r="https://www.yammer.com/api/v1/messages/in_group/"+e;"all"===e&&(r="https://www.yammer.com/api/v1/messages/general.json"),n.ajaxCall("GET",r,i,t)},getUserProfile:function(e,t,a){var n=this,i=$.extend({limit:1},a),r="https://www.yammer.com/api/v1/users/"+e;n.ajaxCall("GET",r,i,t)},getSearchResults:function(e,t,a){var n=this,i=$.extend({page:1,search:e},a),r="https://www.yammer.com/api/v1/search.json";n.ajaxCall("GET",r,i,t)},getGroupsList:function(e,t){var a=this,n=$.extend({limit:1},t),i="https://www.yammer.com/api/v1/users/current.json?include_group_memberships=true";a.ajaxCall("GET",i,n,e)}},Swarm.Client=function(){var e=this;e.leftPane=$(".left-pane"),e.navBar=$(".nav-bar"),e.appBar=$(".app-bar"),e.header=$(".header"),e.content=$("#content"),e.feedsService=new Swarm.Feeds,e.messagesService=new Swarm.Messages,e.analyticsService=new Swarm.Analytics,e.activityFeedService=new Swarm.ActivityFeed,e.searchService=new Swarm.Search,e.postMessageService=new Swarm.PostMessage,e.notificationsService=new Swarm.Notifications,e.groupsService=new Swarm.Groups,e.peopleService=new Swarm.People,e.init()},Swarm.Client.prototype={init:function(){var e=this;e.initBackgroundTasks(),e.bindUserEvents(),e.invokeCustomization(),e.getCurrentUserMugshot(),e.getCurrentUserNetworks(),e.navBar.find("i").first().trigger("click",[!0])},initBackgroundTasks:function(){chrome.alarms.create("checkNewTasks",{when:1e3,periodInMinutes:1}),chrome.browserAction.setBadgeText({text:""})},bindUserEvents:function(){var e=this;e.bindTabSelectEvent(),e.bindSearchEvent(),e.bindPostMessageEvent()},bindBackButtonEvent:function(){var e=this,t=$("#content"),a=$(".header .current-mugshot");a.find("i").on("click",function(){Swarm.api.popCurrentView();var a,n,i,r=Swarm.api.getCurrentView();switch(-1!=r.indexOf("thread")?(a=r.slice(7),r="thread"):-1!=r.indexOf("search")?(n=r.slice(7),r="search"):-1!=r.indexOf("groups:")&&(i=r.slice(7),r="groups"),r){case"feeds":e.makeActiveTab("Feeds","Feeds");break;case"messages":e.makeActiveTab("Messages","Messages");break;case"analytics":e.makeActiveTab("Analytics","Analytics");break;case"Postmessage":e.postMessageService.init();break;case"activityfeed":e.makeActiveTab("Activityfeed","Recent Activity");break;case"notifications":e.makeActiveTab("Notifications","Notifications");break;case"groups":"undefined"==typeof i?e.makeActiveTab("Groups","Groups"):(Swarm.utils.showLoadingIcon(),Swarm.api.getGroupThreads(i,function(e){Swarm.utils.hideLoadingIcon(),t.empty().parent().find(".slimScrollBar").css("top",0),$(".header").find(".page-title").html(e.meta.feed_name),Swarm.utils.buildFeedInfo(!0,e)}));break;case"people":e.makeActiveTab("People","People");break;case"thread":Swarm.api.getThread(a,function(e){$(".header .left-pane").text(Swarm.api.currentViewStack[0]),t.empty(),t.slimScroll().off("slimscroll"),t.slimScroll().removeData("events"),Swarm.utils.hideLoadingIcon(),e.messages.reverse(),Swarm.utils.buildFeedInfo(!0,e),$("div.msg_main").slice(1).css({width:"300px","float":"right","border-left":"3px solid #71a6f6"}).find(".msg_meta").remove()});break;case"search":e.getCurrentUserMugshot(),e.content.html(Swarm.templates.network_feed());var s=e.header.find(".page-title").html("Search");s.html('<div class="mui-form-group"><input type="text" id="search" value="'+n+'" class="mui-form-control mui-empty mui-dirty" /><label><i class="material-icons">search</i>Search</label></div>'),s.find("input").focus(),e.searchService.init(n)}})},bindTabSelectEvent:function(){var e=this;e.leftPane.find("i").click(function(){var t=$(this),a=t.data("jsval"),n=t.attr("title"),i=a.replace(/^[a-z]/,function(e){return e.toUpperCase()});e.leftPane.find("i").removeClass("active"),t.addClass("active"),e.makeActiveTab(i,n)})},bindSearchEvent:function(){var e=this;e.header.on("change","input#search",function(){e.searchService.init($(this).val())})},bindPostMessageEvent:function(){var e=this;e.content.on("click",".post-btn",function(t){e.postMessageService.init()})},scrollToTop:function(){var e=this;e.content.parent().find(".slimScrollBar").css("top",0)},makeActiveTab:function(e,t){var a=this,n=a.header.find(".page-title").html(t);switch(a.content.slimScroll().unbind("slimscroll"),a.scrollToTop(),e){case"Feeds":a.content.html(Swarm.templates.network_feed()),a.getCurrentUserMugshot(),a.feedsService.init();break;case"Messages":a.messagesService.init();break;case"Analytics":a.analyticsService.init();break;case"Postmessage":a.postMessageService.init();break;case"Activityfeed":a.activityFeedService.init();break;case"Notifications":a.notificationsService.init();break;case"Groups":a.groupsService.init();break;case"People":a.peopleService.init();break;case"Search":n.html('<div class="mui-form-group"><input type="text" id="search" class="mui-form-control mui-empty mui-dirty" /><label><i class="material-icons">search</i>Search</label></div>'),n.find("input").focus();break;case"Settings":a.content.html(Swarm.templates.settings());break;case"About":a.content.html(Swarm.templates.about());break;default:console.log("Unregistered service: "+e)}},invokeCustomization:function(){var e=this;e.content.slimScroll({height:"480px",width:"330px",wheelStep:5}).bind("slimscroll",function(e,t){console.log("At position "+t)})},getCurrentUserMugshot:function(){var e=$(".header .current-mugshot");$("#content");0==e.find("img").length&&Swarm.api.getCurrentUserProfile(function(t){e.empty(),e.html($("<img />").attr("src",t.mugshot_url)),Swarm.api.setCurrentUserId(t.id),e.find("img").on("click",function(){Swarm.utils.showProfile(t)})})},getCurrentUserNetworks:function(){var e=this;Swarm.api.getUserNetworks(function(t){e.header.find(".right-pane").html(Swarm.templates.network_selection({networks:t}))})}},Swarm.Feeds=function(){},Swarm.Feeds.prototype={init:function(){var e=this;e.bindTabEvents(),Swarm.api.initCurrentView(),Swarm.api.pushCurrentView("feeds"),$("#content .sw-network-feed-tabs a").first().trigger("click")},bindTabEvents:function(){var e=this;$("#content .sw-network-feed-tabs a").on("click",function(){var t=$(this),a=t.html().toLowerCase();$("#content .network-feed").empty(),$("#content").parent().find(".slimScrollBar").css("top",0),e.getFeeds(a),e.attachWindowScrollEvent(a)})},getFeeds:function(e){e=e||"all",Swarm.utils.showLoadingIcon("#network-feed-"+e),Swarm.api.getThreadedMessagesFeed(e,function(t){Swarm.utils.hideLoadingIcon(),Swarm.utils.buildFeedInfo(!1,t,$("#network-feed-"+e))})},attachWindowScrollEvent:function(e){var t=$("#content");e=e||"all",t.slimScroll().unbind("slimscroll").bind("slimscroll",function(t,a){if("bottom"===a){if($("body").height()!=$(window).height()+window.pageYOffset)return!1;var n=$(".network-feed div.msg_main:last").attr("data-msg-id");Swarm.api.getThreadedMessagesFeed(e,function(t){Swarm.utils.buildFeedInfo(!1,t,$("#network-feed-"+e))},{older_than:n})}})}},Swarm.Groups=function(){},Swarm.Groups.prototype={init:function(){var e=this;Swarm.api.initCurrentView(),Swarm.api.pushCurrentView("groups"),swarmInstance.getCurrentUserMugshot(),e.buildGroupMessageFeed()},buildGroupMessageFeed:function(){var e=this,t=$("#content");Swarm.utils.showLoadingIcon(),Swarm.api.getGroupsList(function(a){Swarm.utils.hideLoadingIcon(),t.empty().html(Swarm.templates.groups({groups:a})),e.bindDisplayGroupEvent()})},bindDisplayGroupEvent:function(){var e=$("#content");e.find(".sw-group-card").off("click").on("click",function(){var t=$(this).data("group-id"),a=$(this).text();Swarm.utils.showLoadingIcon(),Swarm.api.getGroupThreads(t,function(n){Swarm.api.pushCurrentView("groups:"+t),Swarm.api.displayBackButton(),swarmInstance.bindBackButtonEvent(),e.empty().parent().find(".slimScrollBar").css("top",0),$(".header").find(".page-title").html(a),Swarm.utils.hideLoadingIcon(),Swarm.utils.buildFeedInfo(!0,n)})})}},$(document).ready(function(){var e=$("#content");jQuery.ajax({type:"GET",url:"https://www.yammer.com/api/v1/users/current.json?access_token="+yammer.getAccessToken(),data:{limit:1},dataType:"json",xhrFields:{withCredentials:!1},success:function(e){Swarm.api=new Swarm.API(yammer.getAccessToken()),swarmInstance=new Swarm.Client},error:function(){e.empty().html(Swarm.templates.signin_yammer({}))}}),e.off("click",".signin_button").on("click",".signin_button",function(){yammer.openAuthorizationCodePopup()})}),Swarm.Messages=function(){},Swarm.Messages.prototype={init:function(){var e=this;Swarm.api.initCurrentView(),Swarm.api.pushCurrentView("messages"),swarmInstance.getCurrentUserMugshot(),e.getReceivedMessages(),e.attachWindowScrollEvent()},getReceivedMessages:function(){$("#content").empty(),Swarm.utils.showLoadingIcon(),jQuery.ajax({type:"GET",url:"https://www.yammer.com/api/v1/messages/received.json?access_token="+yammer.getAccessToken(),data:{limit:7,extended:!0},dataType:"json",xhrFields:{withCredentials:!1},success:function(e){Swarm.utils.hideLoadingIcon(),chrome.storage.local.set({lastMsgId:e.messages[0].id}),Swarm.utils.buildFeedInfo(!1,e)},error:function(){Swarm.utils.hideLoadingIcon(),alert("error")}})},attachWindowScrollEvent:function(){var e=$("#content");e.slimScroll().off("slimscroll"),e.slimScroll().removeData("events"),e.slimScroll().on("slimscroll"),e.slimScroll().bind("slimscroll",function(e,t){if("bottom"==t){if($("body").height()!=$(window).height()+window.pageYOffset)return!1;var a=$("div.msg_main:last").attr("data-msg-id");jQuery.ajax({type:"GET",url:"https://www.yammer.com/api/v1/messages/received.json?access_token="+yammer.getAccessToken(),data:{limit:7,older_than:a},dataType:"json",xhrFields:{withCredentials:!1},success:function(e){Swarm.utils.buildFeedInfo(!1,e)},error:function(){alert("error")}})}})}},Swarm.Network=function(){},Swarm.Network.prototype={getCurrentNetworkInformation:function(e){jQuery.ajax({type:"GET",url:"https://www.yammer.com/api/v1/networks/current.json?access_token="+yammer.getAccessToken(),dataType:"json",xhrFields:{withCredentials:!1},success:function(t){e?e(t):console.log("Network: No access specified.")},error:function(){alert("error")}})}},Swarm.Notifications=function(){},Swarm.Notifications.prototype={init:function(){var e=this;Swarm.api.initCurrentView(),Swarm.api.pushCurrentView("notifications"),swarmInstance.getCurrentUserMugshot(),e.displayNotifications()},displayNotifications:function(){var e=this;$("#content").empty(),Swarm.utils.showLoadingIcon(),jQuery.ajax({type:"GET",url:"https://www.yammer.com/api/v1/streams/notifications.json?access_token="+yammer.getAccessToken(),data:{limit:20},dataType:"json",xhrFields:{withCredentials:!1},success:function(t){Swarm.utils.hideLoadingIcon(),e.buildNotificationFeed(t)},error:function(){Swarm.utils.hideLoadingIcon(),alert("error")}})},buildNotificationFeed:function(e){var t=$("#content"),a=e.items,n=e.objects.user,i=e.references;0==t.find("div.feed_main").length&&t.append('<div class="feed_main"></div>'),$.each(a,function(e,t){var a,r,s,o,c,l,m,u=t.message,d=[];if($.each(u.split(" "),function(e,t){if(r=t.indexOf("]"),-1!=(a=t.indexOf("user:"))){s=t.substring(a+5,r);var u=$.grep(i,function(e){return e.id==s});p=$.grep(n,function(e){return e.id==s}),o=u.length>0?u[0].full_name:p[0].full_name,c=u.length>0?u[0].mugshot_url:p[0].full_name,m=o}else if(-1!=(a=t.indexOf("group:"))){l=t.substring(a+6,r);var u=$.grep(i,function(e){return e.id==l});o=u.length>0?u[0].full_name:""}else o=t;d.push(o)}),"undefined"==typeof m){s=t.objects[0].id;var p=$.grep(n,function(e){return e.id==s}),o=p.length>0?p[0].full_name:"";c=p.length>0?p[0].mugshot_url:"",m=o}u=d.join(" "),t.userId=s,t.userName=m,t.createdDate=Swarm.utils.getCreatedDate(t.created_at),t.itemUrl=c,t.msg_body=u}),t.find("div.feed_main").append(Swarm.templates.notifications({items:e.items})),t.slimScroll().off("slimscroll"),t.slimScroll().removeData("events"),t.off("click",".feed_main a.senderLinkAnc").on("click",".feed_main a.senderLinkAnc",function(){var e=$(this),t=e.data("user-id"),a=new Swarm.Profile;$(window).off("scroll"),a.init(t)})}},Swarm.People=function(){},Swarm.People.prototype={init:function(){Swarm.api.initCurrentView(),Swarm.api.pushCurrentView("people"),swarmInstance.getCurrentUserMugshot(),this.bindPersonLiveEvent(),this.bindIndexLiveEvent(),this.bindSearchLiveEvent(),this.displayPeopleFeed()},bindSearchLiveEvent:function(){var e=this,t=$(".header").find(".page-title"),a=$("#content");a.off("click",".sw-search").on("click",".sw-search",function(){t.html('<div class="mui-form-group"><input type="text" id="search-people" class="mui-form-control mui-empty mui-dirty" /><label><i class="material-icons">search</i>Search People</label></div>'),t.find("input").focus(),t.off("change","input#search-people").on("change","input#search-people",function(){e.displaySearchResults($(this).val())})})},displayPeopleFeed:function(){var e=$("#content").empty();e.append(Swarm.templates.people({})),e.find(".sw-people-alpha").first().trigger("click")},displayPeopleList:function(e,t,a){var n=this,i=$("#content .sw-people-content");n.pageNumber=e||1,n.initialLetter=t||"A",jQuery.ajax({type:"GET",url:"https://www.yammer.com/api/v1/users.json?access_token="+yammer.getAccessToken(),data:{page:n.pageNumber,letter:n.initialLetter},dataType:"json",xhrFields:{withCredentials:!1},success:function(e){Swarm.utils.hideLoadingIcon(),e.forEach(function(e,t){e.mugshot_url_template=e.mugshot_url_template.replace("{width}x{height}","36x36")}),i.append(Swarm.templates.persons({users:e}))},error:function(){Swarm.utils.hideLoadingIcon(),alert("Looks like something is wrong.")}})},displaySearchResults:function(e){var t=$("#content .sw-people-content");$("#content").slimScroll().unbind("slimscroll"),Swarm.utils.showLoadingIcon(t),Swarm.api.getSearchResults(e,function(e){Swarm.utils.hideLoadingIcon(),e.users.forEach(function(e,t){e.mugshot_url_template=e.mugshot_url_template.replace("{width}x{height}","64x64")}),t.append(Swarm.templates.persons({users:e.users}))})},bindPersonLiveEvent:function(){var e=$("#content");e.off("click",".sw-person").on("click",".sw-person",function(){var e=$(this),t=e.attr("data-user-id");jQuery.ajax({type:"GET",url:"https://www.yammer.com/api/v1/users/"+t+".json?access_token="+yammer.getAccessToken(),data:{limit:1},dataType:"json",xhrFields:{withCredentials:!1},success:function(e){Swarm.api.pushCurrentView("profile"),Swarm.api.displayBackButton(),swarmInstance.bindBackButtonEvent(),Swarm.utils.showProfile(e)},error:function(){alert("Looks like something is wrong.")}})})},bindIndexLiveEvent:function(){var e=this,t=$("#content");t.on("click",".sw-people-alpha",function(){var a=$(this),n=a.attr("value");$(".sw-people-alpha").removeClass("active"),a.addClass("active"),t.find(".sw-people-content").empty(),Swarm.utils.showLoadingIcon("#content .sw-people-content"),e.attachWindowScrollEvent(),e.displayPeopleList(1,n)})},attachWindowScrollEvent:function(){var e=this,t=$("#content");t.slimScroll().unbind("slimscroll").bind("slimscroll",function(t,a){if("bottom"===a){if($("body").height()!=$(window).height()+window.pageYOffset)return!1;e.displayPeopleList(e.pageNumber+1,e.initialLetter)}})}},Swarm.PostMessage=function(){},Swarm.PostMessage.prototype={init:function(){var e=this;e.postMessageToGroup()},postMessageToGroup:function(){var e=this;e.getGroupList()},postMessage:function(){$("#content");$(".post_form").submit(function(){var e=$("select#slt_groups").val(),t=$("textarea#message_body").val();jQuery.ajax({type:"POST",beforeSend:function(e){e.setRequestHeader("Authorization","Bearer "+yammer.getAccessToken())},url:"https://www.yammer.com/api/v1/messages.json?access_token="+yammer.getAccessToken(),data:{group_id:e,body:t},dataType:"json",xhrFields:{withCredentials:!1},success:function(e){},error:function(){alert("error")}})})},getGroupList:function(){var e=this;container=$("#content"),jQuery.ajax({type:"GET",url:"https://www.yammer.com/api/v1/users/current.json?access_token="+yammer.getAccessToken()+"&include_group_memberships=true",data:{limit:1},dataType:"json",xhrFields:{withCredentials:!1},success:function(t){container.empty().html(Swarm.templates.post_message({user:t})),container.slimScroll().off("slimscroll"),container.slimScroll().removeData("events"),container.find('textarea[name="message_body"]').focus(),e.postMessage()},error:function(){alert("error")}})}},Swarm.Profile=function(){},Swarm.Profile.prototype={init:function(e){var t=this;Swarm.api.pushCurrentView("profile"),Swarm.api.displayBackButton(),swarmInstance.bindBackButtonEvent(),t.getProfileInformation(e)},getProfileInformation:function(e){$("#content").empty(),Swarm.utils.showLoadingIcon(),jQuery.ajax({type:"GET",url:"https://www.yammer.com/api/v1/users/"+e+".json?access_token="+yammer.getAccessToken(),data:{limit:1},dataType:"json",xhrFields:{withCredentials:!1},success:function(e){Swarm.utils.hideLoadingIcon(),Swarm.utils.showProfile(e)},error:function(){Swarm.utils.hideLoadingIcon(),alert("profile error")}})},getCurrentUserProfileInformation:function(e){jQuery.ajax({type:"GET",url:"https://www.yammer.com/api/v1/users/current.json?access_token="+yammer.getAccessToken(),data:{limit:1},dataType:"json",xhrFields:{withCredentials:!1},success:function(t){e?e(t):Swarm.utils.showProfile(t)},error:function(){alert("error")}})}},Swarm.Search=function(){},Swarm.Search.prototype={init:function(e){var t=this;if(e.length>0)Swarm.api.initCurrentView(),Swarm.api.pushCurrentView("search:"+e),container=$("#content"),container.empty(),t.getSearchQueryResults(e);else{var a=new Swarm.Feeds;a.init()}},getSearchQueryResults:function(e){var t=this,a=$("#content");Swarm.utils.showLoadingIcon(),jQuery.ajax({type:"GET",url:"https://www.yammer.com/api/v1/search.json?access_token="+yammer.getAccessToken(),data:{search:e,page:1,num_per_page:5},dataType:"json",xhrFields:{withCredentials:!1},success:function(e){Swarm.utils.hideLoadingIcon(),a.html(Swarm.templates.search()),Swarm.utils.buildFeedInfo(!1,e.messages,$("#search_messages")),t.buildUserList(e.users,$("#search_users")),a.slimScroll().off("slimscroll"),a.slimScroll().removeData("events")},error:function(){Swarm.utils.hideLoadingIcon(),alert("error")}})},buildUserList:function(e,t){var a=$("#content"),n=Swarm.templates.users_list({user:e});a.find(t).append(n),a.off("click","a.senderLinkAnc").on("click","a.senderLinkAnc",function(){var e=$(this),t=e.data("user-id"),a=new Swarm.Profile;$(window).off("scroll"),a.init(t)})}},Swarm.utils={showLoadingIcon:function(e){$(e||"#content").html('<div id="loading-icon"><div class="la-square-spin la-2x"><div></div></div>')},hideLoadingIcon:function(){$("#loading-icon").remove()},buildFeedInfo:function(e,t,a){var n=$("#content"),i=t.messages,r=t.references,s=t.threaded_extended;0===n.find("div.feed_main").length&&n.append('<div class="feed_main" />');var o=Swarm.api.getCurrentUserId();$.each(i,function(t,a){var n=$.grep(r,function(e){return"user"===e.type&&e.id==a.sender_id}),i=$.grep(r,function(e){return"group"===e.type&&e.id===a.group_created_id}),c=$.grep(r,function(e){return"thread"===e.type&&e.id===a.thread_id}),l=n.length>0?n[0]:{},m=i.length>0?i[0]:{full_name:"All Company"},u=c.length>0?c[0]:{},d=Swarm.utils.getCreatedDate(a.created_at);a.sender=l,a.createdDate=d,a.extendedThread=(s[a.thread_id]||[]).reverse(),a.mainBody=a.body.rich||a.body.plain,a.mainAttachment=a.attachments.length?a.attachments[0].inline_html||a.attachments[0].comment:"",a.attachment_src=a.attachments.length&&a.attachments[0].image?a.attachments[0].image.url:"",a.file_src=a.attachments.length&&a.attachments[0].file?a.attachments[0].file.url:"",a.file_name=a.attachments.length&&a.attachments[0].file?a.attachments[0].name:"",a.group=m,a.threadInfo=u,a.likedBy={count:Math.max(0,a.liked_by.count-2),names:a.liked_by.names.slice(0,2)};var p=$.grep(a.liked_by.names,function(e){return e.user_id==o});if(a.like_text=p.length>0?"Unlike":"Like",e){var f=$.grep(r,function(e){return"thread"===e.type&&e.id===a.id});a.reply_count=f.length>0&&f[0].stats?--f[0].stats.updates:0}else a.reply_count=--a.threadInfo.stats.updates;if(a.shared_message_id){a.isShared=!0,a.shared_id=a.shared_message_id,a.shared_thread_id=a.attachments[0].thread_id,a.shared_sender_id=a.attachments[0].sender_id,a.shared_createdDate=Swarm.utils.getCreatedDate(a.attachments[0].created_at);var n=$.grep(r,function(e){return"user"===e.type&&e.id==a.shared_sender_id});a.shared_sender=n.length>0?n[0]:{},a.shared_mainBody=a.attachments[0].content_excerpt}a.remainingMessages=e?0:a.threadInfo.stats.updates-a.extendedThread.length,$.each(a.extendedThread,function(e,t){var a=$.grep(r,function(e){return"user"===e.type&&e.id==t.sender_id}),n=$.grep(r,function(e){return"group"===e.type&&e.id===t.group_created_id}),i=$.grep(r,function(e){return"thread"===e.type&&e.id===t.thread_id}),s=a.length>0?a[0]:{},c=n.length>0?n[0]:{full_name:"All Company"},l=i.length>0?i[0]:{},m=Swarm.utils.getCreatedDate(t.created_at);t.sender=s,t.createdDate=m,t.mainBody=t.body.rich||t.body.plain,t.mainAttachment=t.attachments.length?t.attachments[0].inline_html||t.attachments[0].comment||t.attachments[0].content_excerpt:"",t.attachment_src=t.attachments.length&&t.attachments[0].image?t.attachments[0].image.url:"",t.file_src=t.attachments.length&&t.attachments[0].file?t.attachments[0].file.url:"",t.file_name=t.attachments.length&&t.attachments[0].file?t.attachments[0].name:"",t.group=c,t.threadInfo=l,t.likedBy={count:Math.max(0,t.liked_by.count-2),names:t.liked_by.names.slice(0,2)};var u=$.grep(t.liked_by.names,function(e){return e.user_id==o});t.like_text=u.length>0?"Unlike":"Like"})});var c=Swarm.templates.threads(t);a?a.append(n.find("div.feed_main").append(c)):n.find("div.feed_main").append(c),n.off("click",".feed_main a.senderLinkAnc").on("click",".feed_main a.senderLinkAnc",function(e){e.stopPropagation();var t=$(this),a=t.data("user-id"),n=new Swarm.Profile;$(window).off("scroll"),n.init(a)}),n.off("click",".feed_main .msg_details_main .msg_actions .msg_reply").on("click",".feed_main .msg_details_main .msg_actions .msg_reply",function(e){var t=$(this),a="";a=$(e.target).is(".feed_main .msg_content .msg_details_main .msg_actions .msg_reply")?t.parents(".msg_content .msg_details_main"):t.parents(".msg_details_main"),a.find(".reply_message").remove(),a.append(Swarm.templates.reply_message({})),a.find(".reply_message textarea, .reply_message select").focus()}),n.off("click",".feed_main .reply_message .post_button").on("click",".feed_main .reply_message .post_button",function(){var e=$(this),t=e.parents(".msg_main"),a=t.data("msg-id"),n=e.parent().find("textarea").val();jQuery.ajax({type:"POST",beforeSend:function(e){e.setRequestHeader("Authorization","Bearer "+yammer.getAccessToken())},url:"https://www.yammer.com/api/v1/messages.json?access_token="+yammer.getAccessToken(),data:{replied_to_id:a,body:n},dataType:"json",xhrFields:{withCredentials:!1},success:function(t){e.parents(".msg_details_main").find(".msg_body").trigger("click",[!0])},error:function(){alert("error")}})}),n.off("click",".feed_main .msg_actions .msg_share").on("click",".feed_main .msg_actions .msg_share",function(){var e=$(this),t=e.parents(".msg_details_main");jQuery.ajax({type:"GET",url:"https://www.yammer.com/api/v1/users/current.json?access_token="+yammer.getAccessToken()+"&include_group_memberships=true",data:{limit:1},dataType:"json",xhrFields:{withCredentials:!1},success:function(e){t.find(".reply_message").remove(),t.append(Swarm.templates.share_message({groups:e})),t.find(".reply_message textarea, .reply_message select").focus()},error:function(){alert("error")}})}),n.off("click",".feed_main .reply_message .share_button").on("click",".feed_main .reply_message .share_button",function(){var e=$(this),t=e.parents(".msg_main"),a=t.data("msg-id"),i=e.parent().find("textarea").val(),r=$("select#slt_groups").val();jQuery.ajax({type:"POST",beforeSend:function(e){e.setRequestHeader("Authorization","Bearer "+yammer.getAccessToken())},url:"https://www.yammer.com/api/v1/messages.json?access_token="+yammer.getAccessToken(),data:{shared_message_id:a,group_id:r,body:i},dataType:"json",xhrFields:{withCredentials:!1},success:function(e){Swarm.api.getGroupThreads(r,function(e){Swarm.api.pushCurrentView("groups:"+r),Swarm.api.displayBackButton(),swarmInstance.bindBackButtonEvent(),n.empty().parent().find(".slimScrollBar").css("top",0),$(".header").find(".page-title").html(e.meta.feed_name),Swarm.utils.hideLoadingIcon(),Swarm.utils.buildFeedInfo(!0,e)})},error:function(){alert("error")}})}),n.off("click",".feed_main .msg_actions .msg_like").on("click",".feed_main .msg_actions .msg_like",function(){var e,t=$(this),a=t.parents(".msg_main"),n=a.data("msg-id");e=-1!=t.text().indexOf("Like")?"POST":"DELETE",jQuery.ajax({type:e,beforeSend:function(e){e.setRequestHeader("Authorization","Bearer "+yammer.getAccessToken())},url:"https://www.yammer.com/api/v1/messages/liked_by/current.json?message_id="+n+"&access_token="+yammer.getAccessToken(),
data:{message_id:n},dataType:"text",xhrFields:{withCredentials:!1},success:function(e){var a;-1!=t.text().indexOf("Like")?(a=parseInt(t.text().slice(6,7)),t.html("Unlike ("+(a+1)+")")):(a=parseInt(t.text().slice(8,9)),t.html("Like ("+(a-1)+")"))},error:function(){alert("like error")}})}),n.off("click",".feed_main .msg_body, .feed_main .msg_thread_view, .feed_main .msg_shared .msg_body").on("click",".feed_main .msg_body, .feed_main .msg_thread_view, .feed_main .msg_shared .msg_body",function(e){e.stopPropagation();var t=$(this),a=t.data("thread-id");Swarm.api.pushCurrentView("thread:"+a),Swarm.api.displayBackButton(),swarmInstance.bindBackButtonEvent(),Swarm.api.getThread(a,function(e){n.empty(),n.slimScroll().off("slimscroll"),n.slimScroll().removeData("events"),Swarm.utils.hideLoadingIcon(),e.messages.reverse(),Swarm.utils.buildFeedInfo(!0,e),$("div.msg_main").slice(1).css({width:"300px","float":"right","border-left":"3px solid #71a6f6"}).find(".msg_meta").remove()})}),n.off("click",".feed_main .msg_group_title").on("click",".feed_main .msg_group_title",function(){var e=$(this).data("group-id");e&&(Swarm.utils.showLoadingIcon(),Swarm.api.getGroupThreads(e,function(e){n.empty(),n.slimScroll().off("slimscroll"),n.slimScroll().removeData("events"),Swarm.utils.hideLoadingIcon(),Swarm.utils.buildFeedInfo(!1,e)}))}),n.off("click",".feed_main .msg_liked_by").on("click",".feed_main .msg_liked_by",function(){var e=$(this).data("user-id");e&&(Swarm.utils.showLoadingIcon(),Swarm.api.getUserProfile(e,function(e){n.empty(),n.slimScroll().off("slimscroll"),n.slimScroll().removeData("events"),Swarm.utils.hideLoadingIcon(),Swarm.api.pushCurrentView("profile"),Swarm.api.displayBackButton(),swarmInstance.bindBackButtonEvent(),Swarm.utils.showProfile(e)}))}),n.off("click",".feed_main .msg_body .yammer-object").on("click",".feed_main .msg_body .yammer-object",function(e){e.stopPropagation();var t=$(this);if("user"==t.data("resource-model")){var a=t.data("yammer-object").slice(5),n=new Swarm.Profile;$(window).off("scroll"),n.init(a)}})},showProfile:function(e){var t=this,a=$("#content");$(".header").find(".page-title").html("User");e.mugshot_url_template=e.mugshot_url_template.replace("{width}x{height}","100x100"),e.active_since=t.getActiveDuration(new Date(e.activated_at.toString())),a.empty().html(Swarm.templates.user_profile(e)),a.slimScroll().off("slimscroll"),a.slimScroll().removeData("events")},getActiveDuration:function(e){var t=this,a=e,n=new Date;return t.getTimeDuration(a,n)},getTimeDuration:function(e,t){var a=this,n=new Date(Date.UTC(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate())),i=new Date(Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate())),r=n.getDate()-i.getDate();0>r&&(n.setMonth(n.getMonth()-1),r+=a.daysInMonth(n));var s=n.getMonth()-i.getMonth();0>s&&(n.setFullYear(n.getFullYear()-1),s+=12);var o=n.getFullYear()-i.getFullYear(),c="";return o>1&&(c+=o+" years "),s>1&&(c+=s+" months "),r>1&&(c+=r+" days"),c},daysInMonth:function(e){var t=new Date(e.getFullYear(),e.getMonth(),1),a=new Date(e.getFullYear(),e.getMonth()+1,1),n=(a-t)/864e5;return n},getPhoneNumberInfo:function(e){var t=[];for(var a in e)t.push("<div>"),t.push('<div class="phoneType">'+e[a].type+"</div>"),t.push('<div class="phoneNumber"> '+e[a].number+"</div>"),t.push("</div>");return t.join("")},getEmptyStringIfNull:function(e){return null==e||void 0==e?"":e},getCreatedDate:function(e){var t=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],a=new Date,n=new Date(e);if(a.getDate()===n.getDate()&&a.getMonth()===n.getMonth()&&a.getFullYear()===n.getFullYear()){var i=n.getMinutes();i=10>i?"0"+i:i,e=n.getHours()+":"+i}else e=t[n.getMonth()]+" "+n.getDate();return e}};
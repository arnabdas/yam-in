Swarm={},Swarm.ActivityFeed=function(){},Swarm.ActivityFeed.prototype={init:function(){var e=this;e.displayActivityFeed()},displayActivityFeed:function(){{var e=this;$("#content")}$("#content").empty(),Swarm.utils.showLoadingIcon(),jQuery.ajax({type:"GET",url:"https://www.yammer.com/api/v1/streams/activities.json?access_token="+yammer.getAccessToken(),data:{limit:7},dataType:"json",xhrFields:{withCredentials:!1},success:function(t){Swarm.utils.hideLoadingIcon(),e.buildActivityFeed(t)},error:function(){Swarm.utils.hideLoadingIcon(),alert("error")}})},buildActivityFeed:function(e){{var t=$("#content"),s=e.items,i=e.references;e.objects}0==t.find("div.feed_main").length&&t.append('<div class="feed_main"></div>');var a=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],n=[];$.each(s,function(e,t){var s,r,o,c,l,u,d,m=t.message,p=[];$.each(m.split(" "),function(e,t){if(r=t.indexOf("]"),-1!=(s=t.indexOf("user:"))){o=t.substring(s+5,r);var a=$.grep(i,function(e){return e.id==o});c=a.length>0?a[0].full_name:"",l=a.length>0?a[0].mugshot_url:"",d=c}else if(-1!=(s=t.indexOf("group:"))){u=t.substring(s+6,r);var a=$.grep(i,function(e){return e.id==u});c=a.length>0?a[0].full_name:""}else if(-1!=(s=t.indexOf("page:"))){pageId=t.substring(s+5,r);var n=$.grep(i,function(e){return e.id==pageId});c=n.length>0?n[0].full_name:""}else if(-1!=(s=t.indexOf("uploaded_file:"))){pageId=t.substring(s+14,r);var n=$.grep(i,function(e){return e.id==pageId});c=n.length>0?n[0].full_name:""}else c=t;p.push(c)});var h=t.created_at;m=p.join(" ");var f=new Date,g=new Date(h);f.getDate()==g.getDate()&&f.getMonth()==g.getMonth()&&f.getFullYear()==g.getFullYear()?(h=h.split(" ")[1],h=h.split(":")[0]+":"+h.split(":")[1]):h=a[g.getMonth()]+" "+g.getDate(),n.push("<div class='msg_main mui-panel mui-z2' data-msg-id=''>"),n.push("<div class='msg_sender_pic'><a class='senderLinkAnc' data-userid='"+o+"' href='javascript:{}'><img src='"+l+"'/></a></div>"),n.push("<div class='msg_details_main'>"),n.push("<div class='msg_head'>"),n.push("<div class='msg_sender_name'><a class='senderLinkAnc' data-userid='"+o+"' href='javascript:{}'>"+d+"</a></div>"),n.push("<div class='msg_date_time'>"+h+"</div>"),n.push("</div>"),n.push("<div class='msg_body'>"),n.push(m),n.push("</div>"),n.push("</div>"),n.push("</div>")}),t.find("div.feed_main").append(n.join("")),t.slimScroll().off("slimscroll"),t.slimScroll().removeData("events"),t.off("click",".feed_main a.senderLinkAnc").on("click",".feed_main a.senderLinkAnc",function(){var e=$(this),t=e.data("userid"),s=new Swarm.Profile;$(window).off("scroll"),s.init(t)})}},Swarm.Analytics=function(){},Swarm.Analytics.prototype={init:function(){var e=this;$(window).off("scroll"),Swarm.utils.showLoadingIcon(),jQuery.ajax({type:"GET",url:"https://www.yammer.com/api/v1/users/current.json?access_token="+yammer.getAccessToken()+"&include_group_memberships=true",dataType:"json",xhrFields:{withCredentials:!1},success:function(t){$("#content").html('<div id="donut_chart" class="msg_main" style="width:340px;height:250px;padding-top:10px"></div>');var s=e.generateGroupData(t);e.drawChart(s),Swarm.utils.hideLoadingIcon(),$("div.uv-chart-div").off("click"),$("div.uv-chart-div").on("click","g.uv-arc-groups",function(t){e.getGroupMessages(s[$(this).index()].id)})},error:function(){Swarm.utils.hideLoadingIcon(),alert("error")}})},getGroupMessages:function(e){jQuery.ajax({type:"GET",url:"https://www.yammer.com/api/v1/messages/in_group/"+e+".json?access_token="+yammer.getAccessToken(),data:{limit:7},dataType:"json",xhrFields:{withCredentials:!1},success:function(e){$("#content").find("div.feed_main").remove(),Swarm.utils.buildFeedInfo(e)},error:function(){alert("error")}})},generateGroupData:function(e){var t=[];return $.each(e.group_memberships,function(e,s){10>e&&t.push({name:s.full_name,value:21-2*e,id:s.id})}),t},generateGroupChart:function(e,t){var s=this,i=0,a={},n=function(r){a[e.group_memberships[i].id]=r,i++,i<e.group_memberships.length?s.constructGroupData(e,i,n):t(a)};s.constructGroupData(e,i,n)},constructGroupData:function(e,t,s){{var i=e.group_memberships[t].id;e.group_memberships[t].full_name}jQuery.ajax({type:"GET",url:"https://www.yammer.com/api/v1/messages/in_group/"+i+".json?access_token="+yammer.getAccessToken(),dataType:"json",xhrFields:{withCredentials:!1},success:function(e){s(e)},error:function(){alert("error")}})},drawChart:function(e){var t={graph:{bgcolor:"none",custompalette:["#A6CEE3","#1F78B4","#B2DF8A","#33A02C","#FB9A99","#E31A1C","#FDBF6F","#FF7F00","#CAB2D6","#6A3D9A"]},dimension:{width:200,height:200},meta:{caption:"Top 10 groups in the past week"},label:{suffix:"",strokecolor:"#555"},margin:{top:20,bottom:20,left:-1,right:100},caption:{fontvariant:"none"},frame:{bgcolor:"none"},axis:{fontfamily:"Arial"},legend:{position:"right",fontfamily:"Arial"},caption:{fontfamily:"Arial"},subCaption:{fontfamily:"Arial"}},s={categories:["groups"],dataset:{groups:e}};t.meta.position="#donut_chart",uv.chart("Pie",s,t)}},Swarm.API=function(e){var t=this;t.networks={},t.primaryAccessToken=e,t.accessToken=e,t.init()},Swarm.API.prototype={init:function(){var e=this;e.getUserNetworkAccessTokens()},ajaxCall:function(e,t,s,i){var a=this;jQuery.ajax({type:e,url:t,beforeSend:function(e){e.setRequestHeader("Authorization","Bearer "+a.getAccessToken())},data:$.extend({},{},s),dataType:"json",xhrFields:{withCredentials:!1},success:function(e){void 0!==i&&i(e)},error:function(e){console.log(e),alert("Unable to fetch data from Yammer network")}})},setAccessToken:function(e){this.accessToken=e},getAccessToken:function(){return this.accessToken},setNetworks:function(e){var t=this;e.forEach(function(e,s){t.networks[s.network_id]=s})},setPrimaryNetwork:function(e){var t=this;t.activeNetwork=t.networks[e]},switchNetwork:function(e){var t=this;t.activeNetwork=t.networks[networkId],t.setAccessToken(t.activeNetwork.token)},getCurrentUserProfile:function(e){var t=this;t.ajaxCall("GET","https://www.yammer.com/api/v1/users/current.json",{},e)},getUserNetworks:function(e){var t=this;t.ajaxCall("GET","https://www.yammer.com/api/v1/networks/current.json",{},e)},getUserNetworkAccessTokens:function(e){var t=this,s=t.accessToken;t.setAccessToken(t.primaryAccessToken),t.ajaxCall("GET","https://www.yammer.com/api/v1/oauth/tokens.json",{},function(e){t.setNetworks(e),t.setAccessToken(s)})}},Swarm.Client=function(){var e=this;e.navBar=$(".nav-bar"),e.header=$(".header"),e.content=$("#content"),e.feedsService=new Swarm.Feeds,e.messagesService=new Swarm.Messages,e.analyticsService=new Swarm.Analytics,e.activityFeedService=new Swarm.ActivityFeed,e.searchService=new Swarm.Search,e.postMessageService=new Swarm.PostMessage,e.notificationsService=new Swarm.Notifications,e.groupsService=new Swarm.Groups,e.peopleService=new Swarm.People,e.init()},Swarm.Client.prototype={init:function(){var e=this;e.bindUserEvents(),e.invokeCustomization(),e.getCurrentUserMugshot(),e.getCurrentUserNetworks(),e.navBar.find("i").first().trigger("click",[!0])},bindUserEvents:function(){var e=this;e.bindTabSelectEvent(),e.bindSearchEvent()},bindTabSelectEvent:function(){var e=this;e.navBar.find("i").click(function(t,s){var i=$(this),a=i.data("jsval"),n=i.attr("title"),r=a.replace(/^[a-z]/,function(e){return e.toUpperCase()});e.makeActiveTab(r,n),chrome.alarms.create("checkNewTasks",{when:1e3,periodInMinutes:1}),chrome.browserAction.setBadgeText({text:""}),i.parent().siblings().find("i").removeClass("active"),i.addClass("active")})},bindSearchEvent:function(){var e=this;e.header.on("change","input#search",function(){var t=$(this);e.searchService.init(t.val())})},makeActiveTab:function(e,t){var s=this,i=s.header.find(".page-title").html(t);switch(s.content.slimScroll().removeData("events"),s.content.parent().find(".slimScrollBar").css("top",0),e){case"Feeds":s.feedsService.init();break;case"Messages":s.messagesService.init();break;case"Analytics":s.analyticsService.init();break;case"Postmessage":s.postMessageService.init();break;case"Activityfeed":s.activityFeedService.init();break;case"Notifications":s.notificationsService.init();break;case"Groups":s.groupsService.init();break;case"People":s.peopleService.init();break;case"Search":i.html('<div class="mui-form-group"><input type="text" id="search" class="mui-form-control mui-empty mui-dirty" /><label>Search</label></div>'),i.find("input").focus();break;default:console.log("Unregistered service: "+e)}},invokeCustomization:function(){var e=this;e.content.slimScroll({height:"480px",width:"330px"}).bind("slimscroll",function(e,t){console.log("At position "+t)})},getCurrentUserMugshot:function(){{var e=$(".header .current-mugshot");$("#content")}Swarm.api.getCurrentUserProfile(function(t){e.html($("<img />").attr("src",t.mugshot_url_template.replace("{width}x{height}","100x100"))),e.find("img").on("click",function(){Swarm.utils.showProfile(t)})})},getCurrentUserNetworks:function(){var e=this;Swarm.api.getUserNetworks(function(t){e.header.find(".right-pane").html(Handlebars.templates.network_selection({networks:t}))})}},Swarm.Feeds=function(){},Swarm.Feeds.prototype={init:function(){var e=this;e.getFeeds(),e.attachWindowScrollEvent()},getFeeds:function(){$("#content").empty(),Swarm.utils.showLoadingIcon(),jQuery.ajax({type:"GET",url:"https://www.yammer.com/api/v1/messages.json?access_token="+yammer.getAccessToken(),data:{limit:7},dataType:"json",xhrFields:{withCredentials:!1},success:function(e){Swarm.utils.hideLoadingIcon(),Swarm.utils.buildFeedInfo(e),$("#content").append('<div><button class="mui-z3 mui-btn mui-btn-floating mui-btn-floating-mini post-btn"><i class="material-icons">add</i></button></div>'),$(".post-btn").click(function(e){swarmInstance.postMessageService.init()})},error:function(){Swarm.utils.hideLoadingIcon(),alert("Error, Please login to Yammer")}})},attachWindowScrollEvent:function(){var e=$("#content");e.slimScroll().unbind("slimscroll").bind("slimscroll",function(e,t){if("bottom"==t){if($("body").height()!=$(window).height()+window.pageYOffset)return!1;var s=$("div.msg_main:last").attr("data-msg-id");jQuery.ajax({type:"GET",url:"https://www.yammer.com/api/v1/messages.json?access_token="+yammer.getAccessToken(),data:{limit:7,older_than:s},dataType:"json",xhrFields:{withCredentials:!1},success:function(e){Swarm.utils.buildFeedInfo(e)},error:function(){alert("error")}})}})}},Swarm.Groups=function(){},Swarm.Groups.prototype={init:function(){var e=this;e.buildGroupMessageFeed()},buildGroupMessageFeed:function(){var e=this;container=$("#content"),jQuery.ajax({type:"GET",url:"https://www.yammer.com/api/v1/users/current.json?access_token="+yammer.getAccessToken()+"&include_group_memberships=true",data:{limit:1},dataType:"json",xhrFields:{withCredentials:!1},success:function(t){str=[],str.push('<div class="mui-form-group group_list">'),str.push("<label>Groups</label>"),str.push('<div class="mui-select">'),str.push('<select name="groups" id="slt_groups">'),$.each(t.group_memberships,function(e,t){str.push('<option value="'+t.id+'">'+t.full_name+"</option>")}),str.push("</select>"),str.push("</div>"),str.push("</div>"),container.empty().html(str.join("")),e.displayGroupMessages(),$("#slt_groups").trigger("change")},error:function(){alert("error")}})},displayGroupMessages:function(){$("#slt_groups").change(function(){var e=$("#content"),t=$("select#slt_groups").val();jQuery.ajax({type:"GET",url:"https://www.yammer.com/api/v1/messages/in_group/"+t+".json?access_token="+yammer.getAccessToken(),data:{limit:20},dataType:"json",xhrFields:{withCredentials:!1},success:function(t){e.find("div.feed_main").remove(),Swarm.utils.buildFeedInfo(t)},error:function(){alert("error")}})})}},$(document).ready(function(){Swarm.api=new Swarm.API(yammer.getAccessToken()),swarmInstance=new Swarm.Client}),Swarm.Messages=function(){},Swarm.Messages.prototype={init:function(){var e=this;e.getReceivedMessages(),e.attachWindowScrollEvent()},getReceivedMessages:function(){$("#content").empty(),Swarm.utils.showLoadingIcon(),jQuery.ajax({type:"GET",url:"https://www.yammer.com/api/v1/messages/received.json?access_token="+yammer.getAccessToken(),data:{limit:7},dataType:"json",xhrFields:{withCredentials:!1},success:function(e){Swarm.utils.hideLoadingIcon(),chrome.storage.local.set({lastMsgId:e.messages[0].id}),Swarm.utils.buildFeedInfo(e)},error:function(){Swarm.utils.hideLoadingIcon(),alert("error")}})},attachWindowScrollEvent:function(){var e=$("#content");e.slimScroll().off("slimscroll"),e.slimScroll().removeData("events"),e.slimScroll().on("slimscroll"),e.slimScroll().bind("slimscroll",function(e,t){if("bottom"==t){if($("body").height()!=$(window).height()+window.pageYOffset)return!1;var s=$("div.msg_main:last").attr("data-msg-id");jQuery.ajax({type:"GET",url:"https://www.yammer.com/api/v1/messages/received.json?access_token="+yammer.getAccessToken(),data:{limit:7,older_than:s},dataType:"json",xhrFields:{withCredentials:!1},success:function(e){Swarm.utils.buildFeedInfo(e)},error:function(){alert("error")}})}})}},Swarm.Network=function(){},Swarm.Network.prototype={getCurrentNetworkInformation:function(e){jQuery.ajax({type:"GET",url:"https://www.yammer.com/api/v1/networks/current.json?access_token="+yammer.getAccessToken(),dataType:"json",xhrFields:{withCredentials:!1},success:function(t){e?e(t):console.log("Network: No access specified.")},error:function(){alert("error")}})}},Swarm.Notifications=function(){},Swarm.Notifications.prototype={init:function(){var e=this;e.displayNotifications()},displayNotifications:function(){var e=this;$("#content").empty(),Swarm.utils.showLoadingIcon(),jQuery.ajax({type:"GET",url:"https://www.yammer.com/api/v1/streams/notifications.json?access_token="+yammer.getAccessToken(),data:{limit:7},dataType:"json",xhrFields:{withCredentials:!1},success:function(t){Swarm.utils.hideLoadingIcon(),e.buildNotificationFeed(t)},error:function(){Swarm.utils.hideLoadingIcon(),alert("error")}})},buildNotificationFeed:function(e){var t=$("#content"),s=e.items,i=e.objects.user,a=e.references;0==t.find("div.feed_main").length&&t.append('<div class="feed_main"></div>');var n=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],r=[];$.each(s,function(e,t){var s,o,c,l,u,d,m,p=t.message,h=[];if($.each(p.split(" "),function(e,t){if(o=t.indexOf("]"),-1!=(s=t.indexOf("user:"))){c=t.substring(s+5,o);var n=$.grep(a,function(e){return e.id==c});f=$.grep(i,function(e){return e.id==c}),l=n.length>0?n[0].full_name:f[0].full_name,u=n.length>0?n[0].mugshot_url:f[0].full_name,m=l}else if(-1!=(s=t.indexOf("group:"))){d=t.substring(s+6,o);var n=$.grep(a,function(e){return e.id==d});l=n.length>0?n[0].full_name:""}else l=t;h.push(l)}),"undefined"==typeof m){c=t.objects[0].id;var f=$.grep(i,function(e){return e.id==c}),l=f.length>0?f[0].full_name:"";u=f.length>0?f[0].mugshot_url:"",m=l}var g=t.created_at;p=h.join(" ");var v=new Date,w=new Date(g);v.getDate()==w.getDate()&&v.getMonth()==w.getMonth()&&v.getFullYear()==w.getFullYear()?(g=g.split(" ")[1],g=g.split(":")[0]+":"+g.split(":")[1]):g=n[w.getMonth()]+" "+w.getDate(),r.push("<div class='msg_main mui-panel mui-z2' data-msg-id=''>"),r.push("<div class='msg_sender_pic'><a class='senderLinkAnc' data-userid='"+c+"' href='javascript:{}'><img src='"+u+"'/></a></div>"),r.push("<div class='msg_details_main'>"),r.push("<div class='msg_head'>"),r.push("<div class='msg_sender_name'><a class='senderLinkAnc' data-userid='"+c+"' href='javascript:{}'>"+m+"</a></div>"),r.push("<div class='msg_date_time'>"+g+"</div>"),r.push("</div>"),r.push("<div class='msg_body'>"),r.push(p),r.push("</div>"),r.push("</div>"),r.push("</div>")}),t.find("div.feed_main").append(r.join("")),t.slimScroll().off("slimscroll"),t.slimScroll().removeData("events"),t.off("click",".feed_main a.senderLinkAnc").on("click",".feed_main a.senderLinkAnc",function(){var e=$(this),t=e.data("userid"),s=new Swarm.Profile;$(window).off("scroll"),s.init(t)})}},Swarm.People=function(){},Swarm.People.prototype={init:function(){this.bindPersonLiveEvent(),this.bindIndexLiveEvent(),this.displayPeopleFeed()},displayPeopleFeed:function(){var e=$("#content").empty();e.append(Handlebars.templates.people({})),e.find(".sw-people-alpha").first().trigger("click")},displayPeopleList:function(e,t,s){var i=this,a=$("#content .sw-people-content");jQuery.ajax({type:"GET",url:"https://www.yammer.com/api/v1/users.json?access_token="+yammer.getAccessToken(),data:{page:e||1,letter:t||"A"},dataType:"json",xhrFields:{withCredentials:!1},success:function(s){Swarm.utils.hideLoadingIcon(),0!==s.length&&(s.forEach(function(e,t){e.mugshot_url_template=e.mugshot_url_template.replace("{width}x{height}","64x64")}),a.append(Handlebars.templates.persons({users:s})),i.displayPeopleList(e+1,t))},error:function(){Swarm.utils.hideLoadingIcon(),alert("Looks like something is wrong.")}})},bindPersonLiveEvent:function(){var e=$("#content");e.on("click",".sw-person",function(){var e=$(this),t=e.attr("data-user-id");jQuery.ajax({type:"GET",url:"https://www.yammer.com/api/v1/users/"+t+".json?access_token="+yammer.getAccessToken(),data:{limit:1},dataType:"json",xhrFields:{withCredentials:!1},success:function(e){Swarm.utils.showProfile(e)},error:function(){alert("Looks like something is wrong.")}})})},bindIndexLiveEvent:function(){var e=this,t=$("#content");t.on("click",".sw-people-alpha",function(){var s=$(this),i=s.attr("value");$(".sw-people-alpha").removeClass("active"),s.addClass("active"),t.find(".sw-people-content").empty(),Swarm.utils.showLoadingIcon("#content .sw-people-content"),e.displayPeopleList(1,i)})}},Swarm.PostMessage=function(){},Swarm.PostMessage.prototype={init:function(){var e=this;e.postMessageToGroup()},postMessageToGroup:function(){var e=this;e.getGroupList()},postMessage:function(){$(".post_form").submit(function(){var e=$("select#slt_groups").val(),t=$("textarea#message_body").val();jQuery.ajax({type:"POST",beforeSend:function(e){e.setRequestHeader("Authorization","Bearer "+yammer.getAccessToken())},url:"https://www.yammer.com/api/v1/messages.json?access_token="+yammer.getAccessToken(),data:{group_id:e,body:t},dataType:"json",xhrFields:{withCredentials:!1},success:function(e){},error:function(){alert("error")}})})},getGroupList:function(){var e=this;container=$("#content"),jQuery.ajax({type:"GET",url:"https://www.yammer.com/api/v1/users/current.json?access_token="+yammer.getAccessToken()+"&include_group_memberships=true",data:{limit:1},dataType:"json",xhrFields:{withCredentials:!1},success:function(t){str=[],str.push("<div class='post_form mui-panel mui-z2'>"),str.push("<form>"),str.push('<div class="mui-form-group">'),str.push("<label>Groups</label>"),str.push('<div class="mui-select">'),str.push('<select name="groups" id="slt_groups">'),$.each(t.group_memberships,function(e,t){str.push('<option value="'+t.id+'">'+t.full_name+"</option>")}),str.push("</select>"),str.push("</div>"),str.push("</div>"),str.push('<div class="mui-form-group">'),str.push('<textarea name="message_body" class="mui-form-control" id="message_body" rows="10" cols="37"/>'),str.push('<label class="mui-form-floating-label">Write Message Here</label>'),str.push("</div>"),str.push('<input class="post_button mui-btn mui-btn-primary mui-btn-raised mui-btn-flat" type="submit" ></input>'),str.push("</form>"),str.push("</div>"),container.empty().html(str.join("")),container.slimScroll().off("slimscroll"),container.slimScroll().removeData("events"),container.find('textarea[name="message_body"]').focus(),e.postMessage()},error:function(){alert("error")}})}},Swarm.Profile=function(){},Swarm.Profile.prototype={init:function(e){var t=this;t.getProfileInformation(e)},getProfileInformation:function(e){$("#content").empty(),Swarm.utils.showLoadingIcon(),jQuery.ajax({type:"GET",url:"https://www.yammer.com/api/v1/users/"+e+".json?access_token="+yammer.getAccessToken(),data:{limit:1},dataType:"json",xhrFields:{withCredentials:!1},success:function(e){Swarm.utils.hideLoadingIcon(),Swarm.utils.showProfile(e)},error:function(){Swarm.utils.hideLoadingIcon(),alert("error")}})},getCurrentUserProfileInformation:function(e){jQuery.ajax({type:"GET",url:"https://www.yammer.com/api/v1/users/current.json?access_token="+yammer.getAccessToken(),data:{limit:1},dataType:"json",xhrFields:{withCredentials:!1},success:function(t){e?e(t):Swarm.utils.showProfile(t)},error:function(){alert("error")}})}},Swarm.Search=function(){},Swarm.Search.prototype={init:function(e){var t=this;if(e.length>0)container=$("#content"),container.empty(),t.getSearchQueryResults(e);else{var s=new Swarm.Feeds;s.init()}},getSearchQueryResults:function(e){var t=this,s=$("#content");Swarm.utils.showLoadingIcon(),jQuery.ajax({type:"GET",url:"https://www.yammer.com/api/v1/search.json?access_token="+yammer.getAccessToken(),data:{search:e,page:1,num_per_page:5},dataType:"json",xhrFields:{withCredentials:!1},success:function(e){Swarm.utils.hideLoadingIcon();var i=[];s.append('<div class="feed_main"></div>'),i.push('<ul class="mui-tabs mui-tabs-justified">'),i.push('<li class="mui-active"><a class="search_messages" data-mui-toggle="tab" data-mui-controls="search_messages">Messages</a></li>'),i.push('<li><a class="search_users" data-mui-toggle="tab" data-mui-controls="search_users">Users</a></li>'),i.push("</ul>"),i.push('<div class="mui-tab-content">'),i.push('<div class="mui-tab-pane mui-active" id="search_messages">'),i.push(Swarm.utils.buildFeedInfo(e.messages,!0)),i.push("</div>"),i.push('<div class="mui-tab-pane" id="search_users">'),t.buildUserList(e.users,i),i.push("</div>"),i.push("</div>"),s.find("div.feed_main").append(i.join("")),s.slimScroll().off("slimscroll"),s.slimScroll().removeData("events")},error:function(){Swarm.utils.hideLoadingIcon(),alert("error")}})},buildUserList:function(e,t){var s=$("#content");$.each(e,function(e,s){var i=s.full_name,a=s.mugshot_url,n=s.id;t.push("<div class='msg_main mui-panel mui-z2'>"),t.push("<div class='msg_sender_pic'><a class='senderLinkAnc' data-userid='"+n+"' href='javascript:{}'><img src='"+a+"'/></a></div>"),t.push("<div class='msg_details_main'>"),t.push("<div class='msg_head'>"),t.push("<div class='msg_sender_name'><a class='senderLinkAnc' data-userid='"+n+"' href='javascript:{}'>"+i+"</a></div>"),t.push("</div>"),t.push("<div class='msg_body' "),t.push("</div>"),t.push("</div>"),t.push("</div>"),t.push("</div>")}),s.off("click",".msg_sender_name a.senderLinkAnc").on("click",".msg_sender_name a.senderLinkAnc",function(){var e=$(this),t=e.data("userid"),s=new Swarm.Profile;$(window).off("scroll"),s.init(t)})}},Swarm.utils={showLoadingIcon:function(e){$(e||"#content").html('<div id="loading-icon"><div class="la-square-spin la-2x"><div></div></div>')},hideLoadingIcon:function(){$("#loading-icon").remove()},buildFeedInfo:function(e,t){var s=$("#content"),i=e.messages,a=e.references,n=[];0==s.find("div.feed_main").length&&s.append('<div class="feed_main"></div>');var r=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];return $.each(i,function(e,t){var s=$.grep(a,function(e){return e.id==t.sender_id}),i=s.length>0?s[0].full_name:"",o=s.length>0?s[0].mugshot_url:"",c=s.length>0?s[0].id:"",l=t.created_at,u=new Date,d=new Date(l);if(u.getDate()==d.getDate()&&u.getMonth()==d.getMonth()&&u.getFullYear()==d.getFullYear()){var m=d.getMinutes();m=10>m?"0"+m:m,l=d.getHours()+":"+m}else l=r[d.getMonth()]+" "+d.getDate();n.push("<div class='msg_main mui-panel mui-z2' data-msg-id='"+t.id+"'>"),n.push("<div class='msg_sender_pic'><a class='senderLinkAnc' data-userid='"+c+"' href='javascript:{}'><img src='"+o+"'/></a></div>"),n.push("<div class='msg_details_main'>"),n.push("<div class='msg_head'>"),n.push("<div class='msg_sender_name'><a class='senderLinkAnc' data-userid='"+c+"' href='javascript:{}'>"+i+"</a></div>"),n.push("<div class='msg_date_time'>"+l+"</div>"),n.push("</div>"),n.push("<div class='msg_body' data-thread-id='"+t.thread_id+"'>"),n.push(t.body.rich||t.body.plain),0!=t.attachments.length&&n.push(t.attachments[0].inline_html||t.attachments[0].comment||t.attachments[0].content_excerpt||t.attachments[0].name),n.push("</div>"),n.push("<div class='msg_info'>"),n.push("<div class='msg_like_number'><i class='material-icons'>thumb_up</i><span>"+t.liked_by.count+"</span></div>"),n.push("<div class='msg_replies_number'><i class='material-icons'>comment</i><span>0</span></div>"),n.push("</div>"),n.push("</div>"),n.push("</div>")}),t?n.join(""):(s.find("div.feed_main").append(n.join("")),s.off("click",".feed_main a.senderLinkAnc").on("click",".feed_main a.senderLinkAnc",function(){var e=$(this),t=e.data("userid"),s=new Swarm.Profile;$(window).off("scroll"),s.init(t)}),s.off("click",".feed_main .msg_replies_number").on("click",".feed_main .msg_replies_number",function(){var e=$(this),t=e.parents(".msg_details_main"),s=[];0==t.find(".reply_message").length&&(s.push('<div class="reply_message mui-form-group">'),s.push('<textarea name="message_body" class="mui-form-control" id="reply_body" rows="5" cols="37" autofocus/>'),s.push('<button class="post_button mui-btn mui-btn-primary mui-btn-raised mui-btn-flat">Post</button>'),s.push("</div>"),t.append(s.join("")))}),s.off("click",".feed_main .reply_message .post_button").on("click",".feed_main .reply_message .post_button",function(){var e=$(this),t=e.parents(".msg_main"),s=t.data("msg-id"),i=e.parent().find("textarea").val();jQuery.ajax({type:"POST",beforeSend:function(e){e.setRequestHeader("Authorization","Bearer "+yammer.getAccessToken())},url:"https://www.yammer.com/api/v1/messages.json?access_token="+yammer.getAccessToken(),data:{replied_to_id:s,body:i},dataType:"json",xhrFields:{withCredentials:!1},success:function(t){e.parents(".msg_details_main").find(".msg_body").trigger("click",[!0])},error:function(){alert("error")}})}),s.off("click",".feed_main .msg_like_number").on("click",".feed_main .msg_like_number",function(){var e=$(this),t=e.parents(".msg_main"),s=t.data("msg-id");jQuery.ajax({type:"POST",beforeSend:function(e){e.setRequestHeader("Authorization","Bearer "+yammer.getAccessToken())},url:"https://www.yammer.com/api/v1/messages/liked_by/current.json?message_id="+s+"&access_token="+yammer.getAccessToken(),data:{message_id:s},dataType:"text",xhrFields:{withCredentials:!1},success:function(t){var s=parseInt(e.find("span").text());e.find("span").html(s+1)},error:function(){alert("like error")}})}),void s.off("click",".feed_main .msg_body").on("click",".feed_main .msg_body",function(){var e=$(this),t=e.data("thread-id");jQuery.ajax({type:"GET",url:"https://www.yammer.com/api/v1/messages/in_thread/"+t+".json?access_token="+yammer.getAccessToken(),data:{limit:10},dataType:"json",xhrFields:{withCredentials:!1},success:function(e){s.empty(),s.slimScroll().off("slimscroll"),s.slimScroll().removeData("events"),Swarm.utils.hideLoadingIcon(),e.messages.reverse(),Swarm.utils.buildFeedInfo(e),$("div.msg_main").slice(1).css({width:"300px","float":"right","border-left":"3px solid #71a6f6",background:"#f3f5f8"})},error:function(){Swarm.utils.hideLoadingIcon(),alert("error")}})}))},showSearchResults:function(e){container=$("#content"),profile=e,str=[],str.push("<div>"),str.push("<div>Users "+e.count.users+"</div>"),str.push("<div>Messages "+e.count.messages+"</div>"),str.push("<div>Groups "+e.count.groups+"</div>"),str.push("<div>Pages "+e.count.pages+"</div>"),str.push("<div>Topics "+e.count.topics+"</div>"),str.push("<div>"+Swarm.utils.buildFeedInfo(e.messages)+"</div>"),str.push("</div>"),container.empty().html(str.join(""))},showProfile:function(e){var t=this,s=$("#content");e.mugshot_url_template=e.mugshot_url_template.replace("{width}x{height}","100x100"),e.active_since=t.getActiveDuration(new Date(e.activated_at.toString())),s.empty().html(Handlebars.templates.user_profile(e)),s.slimScroll().off("slimscroll"),s.slimScroll().removeData("events")},getActiveDuration:function(e){var t=this,s=e,i=new Date;return t.getTimeDuration(s,i)},getTimeDuration:function(e,t){var s=this,i=new Date(Date.UTC(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate())),a=new Date(Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate())),n=i.getDate()-a.getDate();0>n&&(i.setMonth(i.getMonth()-1),n+=s.daysInMonth(i));var r=i.getMonth()-a.getMonth();0>r&&(i.setFullYear(i.getFullYear()-1),r+=12);var o=i.getFullYear()-a.getFullYear(),c="";return o>1&&(c+=o+" years "),r>1&&(c+=r+" months "),n>1&&(c+=n+" days"),c},daysInMonth:function(e){var t=new Date(e.getFullYear(),e.getMonth(),1),s=new Date(e.getFullYear(),e.getMonth()+1,1),i=(s-t)/864e5;return i},getPhoneNumberInfo:function(e){var t=[];for(var s in e)t.push("<div>"),t.push('<div class="phoneType">'+e[s].type+"</div>"),t.push('<div class="phoneNumber"> '+e[s].number+"</div>"),t.push("</div>");return t.join("")},getEmptyStringIfNull:function(e){return null==e||void 0==e?"":e}};